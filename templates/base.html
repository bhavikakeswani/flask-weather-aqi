<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}SkySQI{% endblock %}</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="{{url_for('static',filename='style.css')}}">
    {% block head %}{% endblock %}
</head>
<body>
    {% include 'navbar.html' %}
    {% block content %}{% endblock %}

    <script>
        window.addEventListener('load', () => {
        const menuBtn = document.getElementById('menuBtn');
        const menuPanel = document.getElementById('menuPanel');
        const profileBtn = document.getElementById('profileBtn');
        const profilePanel = document.getElementById('profilePanel');

        function setupDropdown(btn, panel) {
            if (!btn || !panel) return;
            btn.addEventListener('click', (e) => {
            e.stopPropagation();
            const isVisible = panel.style.display === 'block';
            document.querySelectorAll('.menu, .profile-menu').forEach(p => p.style.display = 'none');
            panel.style.display = isVisible ? 'none' : 'block';
            });
        }

        setupDropdown(menuBtn, menuPanel);
        setupDropdown(profileBtn, profilePanel);

        document.addEventListener('click', (e) => {
            if (!menuBtn.contains(e.target) && !menuPanel.contains(e.target) &&
                !profileBtn.contains(e.target) && !profilePanel.contains(e.target)) {
                    menuPanel.style.display = 'none';
                    profilePanel.style.display = 'none';
            }
        });
});

        document.addEventListener("DOMContentLoaded", () => {
        const body = document.body;
        const toggle = document.querySelector(".switch input");
        const theme = "{{ current_user.theme if current_user.is_authenticated else 'Light' }}";

        if (theme === "Dark") {
            body.classList.add("dark");
            if (toggle) toggle.checked = true;
        } else {
            body.classList.remove("dark");
            if (toggle) toggle.checked = false;
        }

        if (toggle) {
            toggle.addEventListener("change", () => {
                const newTheme = toggle.checked ? "Dark" : "Light";
                body.classList.toggle("dark");

                fetch("{{ url_for('update_preferences') }}", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ theme: newTheme })
                });
            });
        }

        const savedFontSize = "{{ current_user.font_size if current_user.is_authenticated else 'Medium' }}";
        document.body.classList.add(savedFontSize.toLowerCase() + "-font");

        const settingsForm = document.querySelector("#settings-form");
        if (settingsForm) {
            settingsForm.addEventListener("submit", (e) => {
                const selectedFont = document.querySelector("#font-size");
                if (selectedFont) {
                    document.body.classList.remove("small-font", "medium-font", "large-font");
                    document.body.classList.add(selectedFont.value.toLowerCase() + "-font");
                }
            });
        }
    });
    </script>

    {% block scripts %}
    {% endblock %}
</body>
</html>